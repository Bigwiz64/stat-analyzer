{% extends 'base.html' %}
{% block body_class %}match-preview-page{% endblock %}

{% block title %}{{ match.home_team }} vs {{ match.away_team }} - PeakStat{% endblock %}

{% block nav %}
  <a class="nav-button" href="{{ url_for('main.index') }}">‚Üê Retour</a>
{% endblock %}

{% block content %}
{% if match %}
<div class="match-result-card">
  <div class="team team-vertical">
    <img alt="{{ match.home_team }}" class="team-logo-large" src="{{ home_logo }}"/>
    <div class="team-name big">{{ match.home_team }}</div>
    <div class="goal-series" id="home-goal-series"></div>
  </div>
  <div class="score-block">
    <div class="match-date">{{ match.date[:10] }} {{ match.time or '' }}</div>
    {% if match.home_goals is not none and match.away_goals is not none %}
      <div class="score">{{ match.home_goals }} - {{ match.away_goals }}</div>
      <div class="match-status">TERMIN√â</div>
    {% else %}
      <div class="score">‚Äì</div>
      <div class="match-status">√Ä venir</div>
    {% endif %}
  </div>
  <div class="team team-vertical">
    <img alt="{{ match.away_team }}" class="team-logo-large" src="{{ away_logo }}"/>
    <div class="team-name big">{{ match.away_team }}</div>
    <!-- Dans la div .match-result-card apr√®s chaque √©quipe -->
    <div class="goal-series" id="away-goal-series"></div>
  </div>
</div>

<div class="match-panel">
  <div class="player-list-block expanded" id="playerListBlock">
    <div class="scrollable-player-list">
      <div class="team-toggle-buttons">
        <button class="filter-btn active" data-team="all">Tous</button>
        <button class="filter-btn" data-team="home">Domicile</button>
        <button class="filter-btn" data-team="away">Ext√©rieur</button>
      </div>
      <table class="player-table">
        <thead>
          <tr>
            <th data-sort="name">Joueur</th>
            <th data-sort="position">Pos</th>
            <th>√âquipe</th>
            <th data-sort="appearances">App.</th>
            <th data-sort="goals">Buts</th>
            <th data-sort="assists">Passes</th>
            <th data-sort="penalty_scored">Penalty</th>
            <th data-sort="yellow_cards">üü®</th>
            <th data-sort="red_cards">üü•</th>
          </tr>
        </thead>
        <tbody>
          {% for player in match.home_players + match.away_players %}
          <tr class="player-item"
              data-id="{{ player.id }}"
              data-name="{{ player.name }}"
              data-team="{{ 'home' if player in match.home_players else 'away' }}">
            <td>{{ player.name }}</td>
            <td>{{ player.position_abbr }}</td>
            <td><img class="small-team-logo" src="{{ player.team_logo }}" alt="logo"/></td>
            <td>{{ player.appearances or 0 }}</td>
            <td>{{ player.goals }}</td>
            <td>{{ player.assists }}</td>
            <td>{{ player.penalty_scored }}</td>
            <td>{{ player.yellow_cards or 0 }}</td>
            <td>{{ player.red_cards or 0 }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>      
    </div>
  </div>

  <div class="stat-panel collapsed" id="statPanel">
    <button id="togglePanel" class="toggle-panel-btn">üìä Voir les stats <span id="toggle-icon">‚ñº</span></button>
    <div class="stat-content" id="statContent" style="display: none;">
      <h3 id="selected-player-name">Statistiques</h3>
      <div class="form-block" id="player-form" style="display: none;">
        <form id="statForm">
          <div class="stat-button-group" id="stat-buttons"></div>
          <div class="sub-option-group" id="sub-options" style="display: none;"></div>
          <div class="sub-option-group" id="interval-options" style="display: none;"></div>
          <input id="stat" name="stat" type="hidden" value="goals"/>
          <input id="cut" name="cut" type="hidden" value="1"/>
          <input id="filter" name="filter" type="hidden" value=""/>
          <input id="limit" name="limit" type="hidden" value="5"/>
        </form>
      </div>
      <div class="chart-block chart-hidden" id="player-chart" style="display: none;">
        <canvas id="chartCanvas"></canvas>
      </div>
      <div class="performance-slider-wrapper">
        <button class="slider-btn left" id="slider-left">‚Üê</button>
        <div id="performance-cards" class="slider-track"></div>
        <button class="slider-btn right" id="slider-right">‚Üí</button>
      </div>
    </div>
  </div>
</div>


<div class="section-title">
  <h3>Marquer et encaisser</h3>
</div>

<div class="stat-card">

  <div class="filter-top-row">

    <!-- Colonne Domicile -->
    <div class="filter-toggle-column">

      <!-- Groupe Lieu - Domicile -->
      <div class="filter-toggle-group filter-group-lieu-home">
        <button class="filter-btn active">Tous</button>
        <button class="filter-btn">Domicile</button>
        <button class="filter-btn">Ext√©rieure</button>
      </div>

      <!-- Groupe Type - Domicile -->
      <div class="filter-toggle-group filter-group-type-home">
        <button class="filter-btn active">Marqu√©</button>
        <button class="filter-btn">Encaiss√©</button>
      </div>

    </div>

    <!-- Colonne Ext√©rieure -->
    <div class="filter-toggle-column">

      <!-- Groupe Lieu - Ext√©rieure -->
      <div class="filter-toggle-group filter-group-lieu-away">
        <button class="filter-btn active">Tous</button>
        <button class="filter-btn">Domicile</button>
        <button class="filter-btn">Ext√©rieure</button>
      </div>

      <!-- Groupe Type - Ext√©rieure -->
      <div class="filter-toggle-group filter-group-type-away">
        <button class="filter-btn active">Marqu√©</button>
        <button class="filter-btn">Encaiss√©</button>
      </div>

    </div>

  </div>

</div>




  <!-- Section Stats : Temps r√©glementaire -->
  <div class="stat-section-header">Temps r√©glementaire</div>

  <!-- Bloc : Temps r√©glementaire -->
  <div class="stat-block-dual">
    <div class="stat-title">Temps r√©glementaire</div>
    <div class="stat-line-dual">
      <div class="stat-bar-track reverse">
        <div class="stat-bar-fill home" id="home_goal_ratio_bar"></div>
      </div>
      <div class="stat-bar-track">
        <div class="stat-bar-fill away" id="away_goal_ratio_bar"></div>
      </div>
    </div>
  </div>

  <!-- Bloc : Moyenne temps r√©glementaire -->
  <div class="stat-block-dual">
    <div class="stat-title">Moyenne temps r√©glementaire</div>
    <div class="stat-line-dual">
      <div class="stat-bar-track reverse">
        <div class="stat-bar-fill home" id="home_avg_goals_bar"></div>
      </div>
      <div class="stat-bar-track">
        <div class="stat-bar-fill away" id="away_avg_goals_bar"></div>
      </div>
    </div>
  </div>

  <!-- Section Stats : Mi-Temps -->
  <div class="stat-section-header">Mi-Temps</div>

  <!-- Bloc : Mi-Temps -->
  <div class="stat-block-dual">
    <div class="stat-title">Mi-Temps</div>
    <div class="stat-line-dual">
      <div class="stat-bar-track reverse">
        <div class="stat-bar-fill home" id="home_half_time_bar"></div>
      </div>
      <div class="stat-bar-track">
        <div class="stat-bar-fill away" id="away_half_time_bar"></div>
      </div>
    </div>
  </div>

  <!-- Bloc : Moyenne Mi-Temps -->
  <div class="stat-block-dual">
    <div class="stat-title">Moyenne Mi-Temps</div>
    <div class="stat-line-dual">
      <div class="stat-bar-track reverse">
        <div class="stat-bar-fill home" id="home_avg_half_time_bar"></div>
      </div>
      <div class="stat-bar-track">
        <div class="stat-bar-fill away" id="away_avg_half_time_bar"></div>
      </div>
    </div>
  </div>

</div>





<script>
  window.MATCH_ID = {{ match.id | tojson }};
  window.HOME_TEAM_ID = {{ match.home_team_id | tojson }};
  window.AWAY_TEAM_ID = {{ match.away_team_id | tojson }};
</script>

<script src="{{ url_for('static', filename='js/initPlayerPanel.js') }}"></script>
<script src="{{ url_for('static', filename='js/goal_series_loader.js') }}"></script>
<script src="{{ url_for('static', filename='js/player_panel.js') }}"></script>
<script src="{{ url_for('static', filename='js/chart_config.js') }}"></script>
<script src="{{ url_for('static', filename='js/player_list_sort.js') }}"></script>   <!-- ‚úÖ Avant -->
<script src="{{ url_for('static', filename='js/player_list_filter.js') }}"></script>
<script src="{{ url_for('static', filename='js/team_season_stats.js') }}"></script>
<script src="{{ url_for('static', filename='js/stat_buttons.js') }}"></script>
<script src="{{ url_for('static', filename='js/match_preview_main.js') }}"></script> <!-- ‚úÖ Apr√®s -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@1.4.0/dist/chartjs-plugin-annotation.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>


  
{% else %}
<p>‚ö†Ô∏è Match introuvable.</p>
{% endif %}
{% endblock %}
