{% extends "base.html" %}

{% block title %}Matchs de {{ team_name }}{% endblock %}

{% block nav %}
    <a href="{{ url_for('main.index') }}" class="nav-button">‚Üê Retour √† la liste des matchs</a>
{% endblock %}

{% block content %}
    <div class="team-header">
        {% if logo %}
            <img src="{{ logo }}" alt="Logo {{ team_name }}" class="team-logo">
        {% endif %}
        <h1>üìã Matchs de {{ team_name }}</h1>
    </div>

    <div class="team-summary">
        <h2>üìä Statistiques de la saison</h2>
        <ul class="team-stats">
            <li><strong>Matchs jou√©s :</strong> {{ stats.jou√©s }}</li>
            <li><strong>Victoires :</strong> {{ stats.gagn√©s }}</li>
            <li><strong>Nuls :</strong> {{ stats.nuls }}</li>
            <li><strong>D√©faites :</strong> {{ stats.perdus }}</li>
            <li><strong>Buts marqu√©s :</strong> {{ stats.marqu√©s }}</li>
            <li><strong>Buts encaiss√©s :</strong> {{ stats.encaiss√©s }}</li>
            {% if classement_attaque %}
                <li><strong>Classement attaque :</strong> {{ classement_attaque }}·µâ</li>
            {% endif %}
            {% if classement_defense %}
                <li><strong>Classement d√©fense :</strong> {{ classement_defense }}·µâ</li>
            {% endif %}
        </ul>

        <div class="chart-row">
            <div class="chart-box">
                <h3>R√©sultats</h3>
                <canvas id="resultChart"></canvas>
            </div>
            <div class="chart-box">
                <h3>Buts</h3>
                <canvas id="goalChart"></canvas>
            </div>
        </div>
    </div>

    <h2 style="margin-top: 40px;">üìÖ Liste des matchs</h2>

    {% if matches %}
        <ul class="match-list">
            {% for match in matches %}
                <li>
                    <a href="{{ url_for('main.match_redirect', fixture_id=match.id) }}">
                        {{ match.home_team }} vs {{ match.away_team }} ({{ match.score }})
                    </a> ‚Äì {{ match.date }}
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>Aucun match trouv√© pour cette √©quipe.</p>
    {% endif %}

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Donn√©es JSON inject√©es -->
    <script id="team-stats-data" type="application/json">
    {
        "results": [{{ stats.gagn√©s }}, {{ stats.nuls }}, {{ stats.perdus }}],
        "goals": [{{ stats.marqu√©s }}, {{ stats.encaiss√©s }}]
    }
    </script>

    <script>
        const rawData = document.getElementById("team-stats-data").textContent;
        const parsedData = JSON.parse(rawData);

        new Chart(document.getElementById("resultChart"), {
            type: "doughnut",
            data: {
                labels: ["Victoires", "Nuls", "D√©faites"],
                datasets: [{
                    data: parsedData.results,
                    backgroundColor: ["#4CAF50", "#FFC107", "#F44336"],
                    borderWidth: 1
                }]
            },
            options: {
                plugins: {
                    legend: { position: "bottom" }
                }
            }
        });

        new Chart(document.getElementById("goalChart"), {
            type: "doughnut",
            data: {
                labels: ["Buts marqu√©s", "Buts encaiss√©s"],
                datasets: [{
                    data: parsedData.goals,
                    backgroundColor: ["#2196F3", "#9E9E9E"],
                    borderWidth: 1
                }]
            },
            options: {
                plugins: {
                    legend: { position: "bottom" }
                }
            }
        });
    </script>
{% endblock %}
